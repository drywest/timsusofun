<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Overlay</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div id="root">
    <div id="chat"></div>
  </div>

  <script>
    (function () {
      // Supports:
      //   /overlay/<id>
      //   /overlay/<id>/ (trailing slash ok)
      const m = location.pathname.match(/^\/overlay\/([^\/?#]+)\/?$/);
      if (!m) return;

      const id = decodeURIComponent(m[1] || "").trim();
      if (!id) return;

      const qs = new URLSearchParams(location.search);

      // If user already provided params, don't override them.
      const hasAny =
        qs.has("channelId") || qs.has("handle") || qs.has("liveId") || qs.has("videoId");
      if (hasAny) return;

      // Your app.js supports:
      // - channelId=UC...
      // - channelId=@handle (it auto-derives handle)
      // - handle=@handle
      // We'll set channelId always, and also handle for @ just to be safe.
      qs.set("channelId", id);
      if (id.startsWith("@")) qs.set("handle", id);

      const u = new URL(location.href);
      u.search = qs.toString();
      history.replaceState(null, "", u.toString());
    })();
  </script>

  <script src="/app.js" defer></script>
</body>
</html>
